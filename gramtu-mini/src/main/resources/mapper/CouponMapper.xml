<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.frank.gramtu.mini.coupon.CouponRepository">

    <!--
         小程序端个人优惠券Mapper.
         @author 张孝党 2020/01/06.
         @version V0.0.1.
         <p>
         更新履历： V0.0.1 2020/01/06 张孝党 创建.
     -->

    <!-- 查询优惠券 -->
    <select id="getCouponList" parameterType="Map" resultType="Map">
        SELECT
             b.id as id
            ,b.couponname as name
            ,b.upfee as upfee
            ,b.amount as amount
            ,a.couponstatus as status
            ,b.enddate
        FROM
             g_coupon_his a
        LEFT JOIN
             g_coupon b
          ON b.id = a.couponid
        WHERE
             a.openid = #{openid}
         AND b.type = #{type}
         AND a.couponstatus = '0'
        ORDER BY
            a.updtime DESC
        <if test="pagingOrNot != null and pagingOrNot != ''">
            LIMIT #{startindex}, #{pagesize};
        </if>
    </select>

</mapper>